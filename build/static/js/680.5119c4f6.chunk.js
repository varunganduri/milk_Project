"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[680],{7680:(e,s,t)=>{t.r(s),t.d(s,{default:()=>c});var n=t(5043),a=t(3216),r=t(4220),i=t(579);const c=function(){const[e,s]=(0,n.useState)({username:"",mobile_number:""}),[t,c]=(0,n.useState)(null),[o,l]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[m,p]=(0,n.useState)({id:"",mobile_number:""}),[h,j]=(0,n.useState)(!1),[x,b]=(0,n.useState)(""),[g,f]=(0,n.useState)([]),[v,_]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!1),[y,S]=(0,n.useState)(!1),[k,C]=(0,n.useState)({customer_id:"",product_id:"",new_price:""}),[E,P]=(0,n.useState)(""),[T,z]=(0,n.useState)(!1),A=(0,n.useRef)(null),I=(0,a.Zp)();(0,n.useEffect)((()=>{const e=e=>{A.current&&!A.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[A]),(0,n.useEffect)((()=>{const e=localStorage.getItem("authToken");if(!e)return void I("/login");F(),(async()=>{w(!0);try{const s=await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{headers:{Authorization:`Token ${e}`}});if(!s.ok)throw new Error("Failed to fetch customer data");const t=await s.json();l(t.customers),u(t.customers)}catch(t){c(t.message)}finally{w(!1)}})()}),[I]),(0,n.useEffect)((()=>{const e=o.filter((e=>e.mobile_number.includes(x)));u(e)}),[x,o]);const F=async()=>{const e=localStorage.getItem("authToken");try{const t=await fetch("https://prasad-gz5p.onrender.com/api/user/details/",{headers:{Authorization:`Token ${e}`}});if(!t.ok)throw new Error("Failed to fetch customer details");const n=await t.json();s({username:n.username,mobile_number:n.mobile_number})}catch(t){c(t.message)}};return(0,i.jsxs)("div",{className:"customer-home1p7",children:[(0,i.jsx)("h2",{className:"cust-head",children:"Customers"}),(0,i.jsxs)("div",{className:"customer-sectionp7",children:[(0,i.jsxs)("div",{className:"dropdownp7",ref:A,children:[(0,i.jsx)("button",{onClick:()=>{j(!h),h?A.current.classList.remove("dropdown-open"):A.current.classList.add("dropdown-open")},className:"dropdown-togglep7",children:m.mobile_number?(0,i.jsxs)(i.Fragment,{children:[m.mobile_number,(0,i.jsx)("span",{className:"cancel-iconp7",onClick:e=>{e.stopPropagation(),p({id:"",mobile_number:""}),f([])},children:"\xd7"})]}):"Select a Customer"}),h&&(0,i.jsxs)("div",{className:"dropdown-menup7",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by mobile number",value:x,onChange:e=>b(e.target.value),className:"search-inputp7"}),(0,i.jsx)("div",{className:"customer-list-containerp7",children:N?(0,i.jsx)("div",{className:"loaderp7",children:"Loading customers..."}):d.length?(0,i.jsx)("ul",{className:"customer-listp7",children:d.map(((e,s)=>(0,i.jsx)("li",{onClick:()=>(e=>{p({id:e.id,mobile_number:e.mobile_number}),j(!1)})(e),children:e.mobile_number},s)))}):(0,i.jsx)("p",{className:"no-customersp7",children:"No customers found"})})]})]}),(0,i.jsx)("button",{onClick:async()=>{m.id?await(async()=>{const e=localStorage.getItem("authToken");_(!0);try{const s=await fetch(`https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/?customer=${m.id}`,{headers:{Authorization:`Token ${e}`}});if(!s.ok)throw new Error("Failed to fetch customer products");const t=await s.json();f(t.products)}catch(t){c(t.message)}finally{_(!1)}})():alert("Please select a customer before submitting.")},className:"btn-submitp7",disabled:!m.id,children:"Submit Customer"}),!m.mobile_number&&(0,i.jsx)("div",{className:"no-selectedp7",children:(0,i.jsx)("p",{children:"No Customer Selected"})})]}),v?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,i.jsx)(r.A,{})}):m.id&&g.length>0&&(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"product-card-containerp7",children:g.map(((e,s)=>(0,i.jsxs)("div",{className:"cardp7",children:[(0,i.jsx)("div",{className:"image_containerp7",children:(0,i.jsx)("img",{src:e.image_url,alt:e.description,className:"imagep7"})}),(0,i.jsxs)("div",{className:"bottom-sectionp7",children:[(0,i.jsx)("div",{className:"titlep7",children:(0,i.jsx)("p",{children:(0,i.jsx)("span",{children:e.category})})})," ",(0,i.jsx)("hr",{className:"border"}),(0,i.jsx)("div",{className:"descriptionp7",children:(0,i.jsx)("p",{children:e.description})}),(0,i.jsx)("div",{className:"volumep7",children:(0,i.jsxs)("span",{className:"qty",children:["Volume: ",(0,i.jsx)("span",{className:"volume-valuep7",children:e.volume})]})}),(0,i.jsx)("hr",{className:"border"}),(0,i.jsxs)("p",{className:"Final_pricep7",children:["Price: \u20b9",e.final_price]}),e.new_price&&(0,i.jsxs)("p",{style:{color:"red"},children:["New Price: \u20b9",e.new_price]})]}),(0,i.jsx)("button",{className:"edit-buttonp7",onClick:()=>{C({customer_id:m.id,product_id:e.id,new_price:""}),S(!0)},children:"Edit Price"})]},s)))})}),T&&(0,i.jsx)("div",{className:"popup-notificationp7",children:E}),y&&(0,i.jsx)("div",{className:"modalp7",children:(0,i.jsxs)("div",{className:"modal-contentp7",children:[(0,i.jsx)("h2",{children:"Edit Product Price for Customer"}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const s=localStorage.getItem("authToken");try{if(!(await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{method:"POST",headers:{Authorization:`Token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(k)})).ok)throw new Error("Failed to update price");f((e=>e.map((e=>e.id===k.product_id?{...e,final_price:k.new_price}:e)))),P("Price updated successfully!")}catch(t){P("Error: "+t.message)}finally{S(!1),C({customer_id:"",product_id:"",new_price:""}),z(!0),setTimeout((()=>{z(!1)}),1e3)}},children:[(0,i.jsxs)("label",{children:["Customer ID:",(0,i.jsx)("input",{type:"number",name:"customer_id",value:k.customer_id,readOnly:!0})]}),(0,i.jsxs)("label",{children:["Product ID:",(0,i.jsx)("input",{type:"text",name:"product_id",value:k.product_id,readOnly:!0})]}),(0,i.jsxs)("label",{children:["New Price:",(0,i.jsx)("input",{type:"number",name:"new_price",value:k.new_price,onChange:e=>{const{name:s,value:t}=e.target;C({...k,[s]:t})},required:!0})]}),(0,i.jsx)("button",{type:"submit",children:"Submit"}),(0,i.jsx)("button",{type:"button",onClick:()=>S(!1),children:"Cancel"})]})]})})]})}},4220:(e,s,t)=>{t.d(s,{A:()=>a});t(5043);var n=t(579);const a=()=>(0,n.jsx)("div",{className:"dot-spinner",children:Array.from({length:8},((e,s)=>(0,n.jsx)("div",{className:`dot-spinner__dot dot-spinner__dot--${s+1}`},s)))})}}]);
//# sourceMappingURL=680.5119c4f6.chunk.js.map