"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[255],{8255:(e,s,t)=>{t.r(s),t.d(s,{default:()=>c});var a=t(5043),n=t(3216),r=t(4594),i=t(579);const c=function(){const[,e]=(0,a.useState)({username:"",mobile_number:""}),[,s]=(0,a.useState)(null),[t,c]=(0,a.useState)([]),[o,l]=(0,a.useState)([]),[d,m]=(0,a.useState)({id:"",mobile_number:""}),[u,p]=(0,a.useState)(!1),[h,j]=(0,a.useState)(""),[x,b]=(0,a.useState)([]),[g,_]=(0,a.useState)(!1),[N,f]=(0,a.useState)(!1),[v,w]=(0,a.useState)(!1),[y,S]=(0,a.useState)({customer_id:"",product_id:"",new_price:""}),[k,C]=(0,a.useState)(""),[T,E]=(0,a.useState)(!1),P=(0,a.useRef)(null),z=(0,n.Zp)();(0,a.useEffect)((()=>{const e=localStorage.getItem("authToken");if(!e)return void z("/login");A(),(async()=>{f(!0);try{const s=await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{headers:{Authorization:`Token ${e}`}});if(!s.ok)throw new Error("Failed to fetch customer data");const t=await s.json();c(t.customers),l(t.customers)}catch(t){s(t.message)}finally{f(!1)}})()}),[z]),(0,a.useEffect)((()=>{const e=t.filter((e=>e.mobile_number.includes(h)));l(e)}),[h,t]);const A=async()=>{const t=localStorage.getItem("authToken");try{const s=await fetch("https://prasad-gz5p.onrender.com/api/user/details/",{headers:{Authorization:`Token ${t}`}});if(!s.ok)throw new Error("Failed to fetch customer details");const a=await s.json();e({username:a.username,mobile_number:a.mobile_number})}catch(a){s(a.message)}};return(0,i.jsxs)("div",{className:"customer-home1p7",children:[(0,i.jsx)("h2",{children:"Customers"}),(0,i.jsxs)("div",{className:"customer-sectionp7",children:[(0,i.jsxs)("div",{className:"dropdownp7",ref:P,children:[(0,i.jsx)("button",{onClick:()=>{p(!u),u?P.current.classList.remove("dropdown-open"):P.current.classList.add("dropdown-open")},className:"dropdown-togglep7",children:d.mobile_number?(0,i.jsxs)(i.Fragment,{children:[d.mobile_number,(0,i.jsx)("span",{className:"cancel-iconp7",onClick:()=>{m({id:"",mobile_number:""}),b([])},children:"\xd7"})]}):"Select a Customer"}),u&&(0,i.jsxs)("div",{className:"dropdown-menup7",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by mobile number",value:h,onChange:e=>j(e.target.value),className:"search-inputp7"}),(0,i.jsx)("div",{className:"customer-list-containerp7",children:N?(0,i.jsx)("div",{className:"loader",children:"Loading customers..."}):o.length?(0,i.jsx)("ul",{className:"customer-listp7",children:o.map(((e,s)=>(0,i.jsx)("li",{onClick:()=>(e=>{m({id:e.id,mobile_number:e.mobile_number}),p(!1)})(e),children:e.mobile_number},s)))}):(0,i.jsx)("p",{className:"no-customersp7",children:"No customers found"})})]})]}),(0,i.jsx)("button",{onClick:async()=>{d.id&&await(async()=>{const e=localStorage.getItem("authToken");_(!0);try{const s=await fetch(`https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/?customer=${d.id}`,{headers:{Authorization:`Token ${e}`}});if(!s.ok)throw new Error("Failed to fetch customer products");const t=await s.json();b(t.products)}catch(t){s(t.message)}finally{_(!1)}})()},className:"btn-submitp7",disabled:!d.id,children:"Submit Customer"})]}),g?(0,i.jsx)("div",{className:"spinnerp7",children:(0,i.jsx)(r.A,{})}):d.id&&x.length>0&&(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"product-card-containerp7",children:x.map(((e,s)=>(0,i.jsxs)("div",{className:"cardp7",children:[(0,i.jsx)("div",{className:"image_containerp7",children:(0,i.jsx)("img",{src:e.image_url,alt:e.description,className:"imagep7"})}),(0,i.jsxs)("div",{className:"bottom-sectionp7",children:[(0,i.jsx)("div",{className:"titlep7",children:(0,i.jsx)("p",{children:(0,i.jsx)("span",{children:e.category})})})," ",(0,i.jsx)("hr",{className:"border"}),(0,i.jsx)("div",{className:"descriptionp7",children:(0,i.jsx)("p",{children:e.description})}),(0,i.jsx)("div",{className:"volumep7",children:(0,i.jsxs)("span",{className:"qty",children:["Volume: ",(0,i.jsx)("span",{className:"volume-valuep7",children:e.volume})]})}),(0,i.jsx)("hr",{className:"border"}),(0,i.jsxs)("p",{className:"Final_pricep7",children:["Price: \u20b9",e.final_price]}),e.new_price&&(0,i.jsxs)("p",{style:{color:"red"},children:["New Price: \u20b9",e.new_price]})]}),(0,i.jsx)("button",{className:"edit-buttonp7",onClick:()=>{S({customer_id:d.id,product_id:e.id,new_price:""}),w(!0)},children:"Edit Price"})]},s)))})}),T&&(0,i.jsx)("div",{className:"popup-notificationp7",children:k}),v&&(0,i.jsx)("div",{className:"modalp7",children:(0,i.jsxs)("div",{className:"modal-contentp7",children:[(0,i.jsx)("h2",{children:"Edit Product Price for Customer"}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const s=localStorage.getItem("authToken");try{if(!(await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{method:"POST",headers:{Authorization:`Token ${s}`,"Content-Type":"application/json"},body:JSON.stringify(y)})).ok)throw new Error("Failed to update price");b((e=>e.map((e=>e.id===y.product_id?{...e,final_price:y.new_price}:e)))),C("Price updated successfully!")}catch(t){C("Error: "+t.message)}finally{w(!1),S({customer_id:"",product_id:"",new_price:""}),E(!0),setTimeout((()=>{E(!1)}),1e3)}},children:[(0,i.jsxs)("label",{children:["Customer ID:",(0,i.jsx)("input",{type:"number",name:"customer_id",value:y.customer_id,readOnly:!0})]}),(0,i.jsxs)("label",{children:["Product ID:",(0,i.jsx)("input",{type:"text",name:"product_id",value:y.product_id,readOnly:!0})]}),(0,i.jsxs)("label",{children:["New Price:",(0,i.jsx)("input",{type:"number",name:"new_price",value:y.new_price,onChange:e=>{const{name:s,value:t}=e.target;S({...y,[s]:t})},required:!0})]}),(0,i.jsx)("button",{type:"submit",children:"Submit"}),(0,i.jsx)("button",{type:"button",onClick:()=>w(!1),children:"Cancel"})]})]})})]})}},4594:(e,s,t)=>{t.d(s,{A:()=>n});t(5043);var a=t(579);const n=()=>(0,a.jsx)("div",{className:"dot-spinner-container",children:(0,a.jsx)("div",{className:"dot-spinner",children:Array.from({length:8},((e,s)=>(0,a.jsx)("div",{className:`dot-spinner__dot dot-spinner__dot--${s+1}`},s)))})})}}]);
//# sourceMappingURL=255.617b4547.chunk.js.map