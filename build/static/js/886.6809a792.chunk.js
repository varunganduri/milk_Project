"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[886],{886:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});var r=s(5043),a=s(7762),o=s(4594),c=s(579);const n=()=>{const[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)(""),[i,l]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[m,u]=(0,r.useState)(""),[p,j]=(0,r.useState)(""),[x,g]=(0,r.useState)(null),[f,v]=(0,r.useState)(!1),[N,V]=(0,r.useState)([]),[b,y]=(0,r.useState)(!0);(0,r.useEffect)((()=>{(async()=>{y(!0);const e=localStorage.getItem("authToken");try{const s=await fetch("https://prasad-gz5p.onrender.com/api/manage-negotiated-prices/",{method:"GET",headers:{Authorization:`Token ${e}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch customers");const r=await s.json();t(r.customers||[])}catch(s){console.error("Error fetching customers:",s)}finally{y(!1)}})(),(async()=>{const e=localStorage.getItem("authToken");try{const t=await fetch("https://prasad-gz5p.onrender.com/api/products/",{method:"GET",headers:{Authorization:`Token ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch products");const s=await t.json();V(s)}catch(t){console.error("Error fetching products:",t)}})()}),[]),(0,r.useEffect)((()=>{(async()=>{if(!s)return;y(!0);const e=localStorage.getItem("authToken");try{const t=await fetch("https://prasad-gz5p.onrender.com/api/view-customer-orders/",{method:"GET",headers:{Authorization:`Token ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch orders");const r=(await t.json()).orders.invoices.filter((e=>e.customer_mobile_number===s));l(r),h(r)}catch(t){console.error("Error fetching orders:",t)}finally{y(!1)}})()}),[s]),(0,r.useEffect)((()=>{let e=i;m&&(e=e.filter((e=>e.id.toString().includes(m)||e.price.toString().includes(m)))),p&&(e=e.filter((e=>e.date===p))),h(e)}),[m,p,i]);return(0,c.jsx)("div",{className:"customer-orders-container-V040",children:b?(0,c.jsx)("div",{className:"loader",children:(0,c.jsx)(o.A,{})}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h2",{className:"customer-orders-title-V040",children:"Select Customer"}),(0,c.jsxs)("select",{className:"customer-select-V040",value:s,onChange:e=>n(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Select a customer"}),e.map((e=>(0,c.jsx)("option",{value:e.mobile_number,children:e.mobile_number},e.id)))]}),(0,c.jsxs)("div",{className:"filter-container-V040",children:[(0,c.jsx)("input",{type:"text",className:"search-input-V040",placeholder:"Search by Order ID or Price",value:m,onChange:e=>u(e.target.value)}),(0,c.jsx)("input",{type:"date",className:"date-picker-V040",value:p,onChange:e=>j(e.target.value)})]}),d.length>0?(0,c.jsxs)("div",{className:"orders-section-V040",children:[(0,c.jsxs)("h3",{className:"orders-title-V040",children:["Orders for ",s]}),(0,c.jsxs)("table",{className:"orders-table-V040",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"table-header-V040",children:[(0,c.jsx)("th",{className:"table-header-item-V040",children:"Order ID"}),(0,c.jsx)("th",{className:"table-header-item-V040",children:"Customer Name"}),(0,c.jsx)("th",{className:"table-header-item-V040",children:"Price"}),(0,c.jsx)("th",{className:"table-header-item-V040",children:"Date"}),(0,c.jsx)("th",{className:"table-header-item-V040",children:"Supplier"})]})}),(0,c.jsx)("tbody",{children:d.map((e=>(0,c.jsxs)("tr",{className:"table-row-V040",onClick:()=>(async e=>{try{const t=localStorage.getItem("authToken"),s=await fetch(`https://prasad-gz5p.onrender.com/api/view-invoice/${e}/`,{method:"GET",headers:{Authorization:`Token ${t}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch invoice details");const r=await s.json();g(r),v(!0)}catch(t){console.error("Error fetching invoice details:",t)}})(e.id),children:[(0,c.jsx)("td",{className:"table-data-V040",children:e.id}),(0,c.jsx)("td",{className:"table-data-V040",children:e.customer_name}),(0,c.jsx)("td",{className:"table-data-V040",children:e.price}),(0,c.jsx)("td",{className:"table-data-V040",children:e.date}),(0,c.jsx)("td",{className:"table-data-V040",children:e.supplier_name})]},e.id)))})]})]}):s&&(0,c.jsx)("div",{className:"no-orders-message-V040",children:(0,c.jsx)("p",{children:"No orders found for the selected customer."})}),f&&x&&(0,c.jsx)("div",{className:"modal-VA40",children:(0,c.jsxs)("div",{className:"modal-content-VA40",children:[(0,c.jsxs)("h3",{children:["Invoice ID: ",x.invoice_id]}),(0,c.jsx)("h4",{children:"Items:"}),(0,c.jsx)("ul",{children:x.items.map(((e,t)=>{const s=(e=>{const t=N.find((t=>t.productid===e));return console.log(t),t})(e.product_id);return(0,c.jsx)("li",{className:"invoice-item-VA40",children:(0,c.jsxs)("div",{className:"invoice-item-wrapper-VA40",children:[(0,c.jsx)("div",{className:"invoice-product-image-VA40",children:s&&s.productImage&&(0,c.jsx)("img",{src:s.productImage,alt:s.productCategory})}),(0,c.jsxs)("div",{className:"invoice-item-details-VA40",children:[(0,c.jsxs)("strong",{children:["Product ID: ",e.product_id," "]}),"  ",(0,c.jsx)("br",{}),(0,c.jsxs)("strong",{children:["Quantity: ",e.quantity]}),"  ",(0,c.jsx)("br",{}),(0,c.jsxs)("strong",{children:["Total Price: ",e.total_price]}),"  ",(0,c.jsx)("br",{}),s&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("strong",{children:["Category: ",s.productCategory," "]}),"  ",(0,c.jsx)("br",{}),(0,c.jsxs)("strong",{children:["Volume: ",s.productVolume]})]})]})]})},t)}))}),(0,c.jsx)("button",{className:"modal-close-button-VA40",onClick:()=>{v(!1),g(null)},children:"Close"}),(0,c.jsx)("button",{className:"download-button-VA40",onClick:()=>{const e=new a.Ay;e.setFontSize(16),e.text(`Invoice ID: ${x.invoice_id}`,10,10),e.text("Items:",10,20);let t=30;x.items.forEach(((s,r)=>{const a=N.find((e=>e.productid===s.product_id)),o=`\n        Product ID: ${s.product_id}\n        Quantity: ${s.quantity}\n        Total Price: ${s.total_price}\n        ${a?`Category: ${a.productCategory}`:""}\n        ${a?`Volume: ${a.productVolume}`:""}\n      `,c=e.splitTextToSize(o,170);e.text(c,10,t),t+=10*c.length})),e.save(`invoice_${x.invoice_id}.pdf`)},children:"Download PDF"})]})})]})})}},4594:(e,t,s)=>{s.d(t,{A:()=>a});s(5043);var r=s(579);const a=()=>(0,r.jsx)("div",{className:"dot-spinner-container",children:(0,r.jsx)("div",{className:"dot-spinner",children:Array.from({length:8},((e,t)=>(0,r.jsx)("div",{className:`dot-spinner__dot dot-spinner__dot--${t+1}`},t)))})})}}]);
//# sourceMappingURL=886.6809a792.chunk.js.map